<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>PDF Viewer</title>
	<style>
		.container {
			max-width: 1200px;
			margin: 0 auto;
			padding: 20px;
			display: flex;
			flex-direction: column;
			align-items: center;
			position: relative;
		}

		.input-group {
			margin-bottom: 20px;
			display: flex;
			gap: 10px;
			position: fixed;
			top: 20px;
			right: 20px;
			z-index: 1000;
		}

		.pdf-pages {
			display: flex;
			flex-direction: column;
			gap: 20px;
		}

		.pdf-container {
			width: 21cm;
			height: 29cm;
			border: 1px solid #ccc;
			position: relative;
			background: white;
		}

		canvas {
			width: 21cm !important;
			height: 29cm !important;
			image-rendering: -webkit-optimize-contrast;
			image-rendering: crisp-edges;
		}

		button {
			padding: 8px 16px;
			background-color: #4CAF50;
			color: white;
			border: none;
			border-radius: 4px;
			cursor: pointer;
		}

		button:hover {
			background-color: #45a049;
		}

		select {
			padding: 5px;
			border-radius: 4px;
			border: 1px solid #ccc;
			font-family: Arial, sans-serif;
			font-size: 14px;
		}

		.name_amil {
			position: absolute;
			top: 210px;
			left: 238px;
			font-size: 12pt;
			font-weight: bold;
			border: 0;
			background: transparent;
			text-transform: uppercase;
			width: 250px;
		}

		#overall {
			position: absolute;
			top: 959px;
			left: 660px;
			font-size: 12pt;
			font-weight: bold;
			border: 0;
			background: transparent;
			text-transform: uppercase;
			width: 107px;
			text-align: right;
			font-family: arial;
		}

		.marked {
			position: absolute;
			left: 743px;
			height: 29px;
			display: none;
		}

		/* Marked positions for different coupon types */
		.marked-7 {
			top: 219px;
			display: block;
		}

		.marked-10 {
			top: 236px;
			display: block;
		}

		.marked-15 {
			top: 255px;
			display: block;
		}

		.marked-25 {
			top: 272px;
			display: block;
		}

		@media print {
			@page {
				size: A4;
				margin: 0;
				padding: 0;
			}

			.input-group {
				display: none;
			}

			.container {
				padding: 0;
			}

			.pdf-container {
				border: none;
				page-break-after: always;
			}
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="input-group">
			<select id="amilName">
				<option value="">Pilih Amil</option>
			</select>
			<button onclick="printPDF()">Print</button>
		</div>
		<div id="pdf-pages" class="pdf-pages">
			<!-- PDF containers will be added here dynamically -->
		</div>
	</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
	<script>
		let amilData = [];
		const pdfPages = document.getElementById('pdf-pages');

		// Format currency to 2 decimal places without RM symbol
		function formatCurrency(amount) {
			return amount.toFixed(2);
		}

		// Pad number with zeros
		function padNumber(num, size = 6) {
			num = num.toString();
			while (num.length < size) num = "0" + num;
			return num;
		}

		// Load amil JSON data
		async function loadAmilData() {
			try {
				const response = await fetch('amil.json');
				amilData = await response.json();
				setupAmilDropdown();
			} catch (error) {
				console.error('Error loading amil data:', error);
			}
		}

		// Setup amil dropdown
		function setupAmilDropdown() {
			const amilSelect = document.getElementById('amilName');
			amilSelect.innerHTML = '<option value="">Pilih Amil</option>';

			amilData.forEach((amil, index) => {
				const option = document.createElement('option');
				option.value = index;
				option.textContent = amil.name;
				amilSelect.appendChild(option);
			});

			amilSelect.addEventListener('change', processAmilData);
		}

		// Process amil data and create PDF pages
		async function processAmilData() {
			const amilSelect = document.getElementById('amilName');
			pdfPages.innerHTML = ''; // Clear existing pages

			if (amilSelect.value === '') return;

			const selectedAmilIndex = parseInt(amilSelect.value);
			const amil = amilData[selectedAmilIndex];

			// Get all coupon types for this amil
			const couponTypes = Object.keys(amil).filter(key => !isNaN(key));

			// Create a page for each coupon type
			for (const couponType of couponTypes) {
				const container = document.createElement('div');
				container.className = 'pdf-container';
				container.id = `pdf-container-${couponType}`;

				// Add name input
				const nameInput = document.createElement('input');
				nameInput.type = 'text';
				nameInput.className = 'name_amil';
				nameInput.value = amil.name;
				nameInput.readOnly = true;

				// Add marked image
				const markedImg = document.createElement('img');
				markedImg.src = 'marked.png';
				markedImg.className = `marked marked-${couponType}`;

				// Add canvas for PDF
				const canvas = document.createElement('canvas');

				container.appendChild(canvas);
				container.appendChild(nameInput);
				container.appendChild(markedImg);
				pdfPages.appendChild(container);

				// Load PDF into this container
				await loadPDF(container.id, canvas);
			}
		}

		// Load PDF into specific container
		async function loadPDF(containerId, canvas) {
			try {
				const response = await fetch('default.pdf');
				const pdfData = new Uint8Array(await response.arrayBuffer());

				const loadingTask = pdfjsLib.getDocument({ data: pdfData });
				const pdf = await loadingTask.promise;

				const page = await pdf.getPage(1);
				const viewport = page.getViewport({ scale: 1.5 });

				const context = canvas.getContext('2d');
				canvas.height = viewport.height;
				canvas.width = viewport.width;

				await page.render({
					canvasContext: context,
					viewport: viewport
				}).promise;
			} catch (error) {
				console.error('Error loading PDF:', error);
			}
		}

		function printPDF() {
			window.print();
		}

		// Initialize
		pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';
		window.addEventListener('DOMContentLoaded', loadAmilData);
	</script>
</body>

</html>